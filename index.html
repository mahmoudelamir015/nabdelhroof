<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نبض الحروف - إتقان فن الكتابة السريعة</title>
    
    <!-- المكتبات الخارجية -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* متغيرات التصميم المتقدمة */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --dark-gradient: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            --warning-gradient: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #4facfe;
            --danger: #f5576c;
            --warning: #ff9a56;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #2d3748;
            --bg-light: #f7fafc;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-full: 9999px;
        }

        /* الوضع الليلي */
        body.dark-mode {
            --bg-light: #1a202c;
            --light: #2d3748;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --dark: #f7fafc;
        }

        /* الإعدادات العامة */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Cairo', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* شريط التنقل المحسن والثابت */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: var(--shadow-md);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        body.dark-mode .navbar {
            background: rgba(45, 55, 72, 0.95);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .logo i {
            font-size: 2.5rem;
            -webkit-text-fill-color: var(--primary);
            animation: logoRotate 4s linear infinite;
        }

        @keyframes logoRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.95rem;
        }

        .nav-links a:hover {
            color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .nav-links a.active {
            color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--primary-gradient);
            border-radius: var(--radius-full);
        }

        /* معلومات المستخدم في الناف بار */
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            border: 2px solid var(--primary);
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.1);
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-level {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* الأزرار المحسنة */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            font-size: 1rem;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
            color: white;
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* الصفحة الرئيسية المحسنة */
        .hero {
            padding: 8rem 2rem 4rem;
            text-align: center;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            position: relative;
            overflow: hidden;
            margin-top: 80px;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: fadeInUp 1s ease;
        }

        .hero p {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
            animation: fadeInUp 1s ease 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 1s ease 0.4s both;
        }

        /* بطاقات الإنجازات */
        .achievements {
            padding: 4rem 0;
        }

        .section-title {
            text-align: center;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 3rem;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: var(--radius-full);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .achievement-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        body.dark-mode .achievement-card {
            background: var(--light);
        }

        .achievement-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--primary-gradient);
        }

        .achievement-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .achievement-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .achievement-icon.primary {
            background: var(--primary-gradient);
        }

        .achievement-icon.success {
            background: var(--success-gradient);
        }

        .achievement-icon.warning {
            background: var(--warning-gradient);
        }

        /* صفحة التدريب المحسنة */
        .training-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            margin-top: 100px;
        }

        body.dark-mode .training-container {
            background: var(--light);
        }

        .training-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .language-selector {
            display: flex;
            gap: 1rem;
        }

        .lang-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .lang-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
            transform: scale(1.05);
        }

        .difficulty-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .difficulty-selector select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--primary);
            border-radius: var(--radius-md);
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1rem;
            min-width: 150px;
        }

        .text-selector {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .text-length-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .text-length-btn.active {
            background: var(--primary);
            color: white;
        }

        .text-display {
            background: var(--bg-light);
            padding: 2.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            line-height: 2.2;
            font-size: 1.3rem;
            position: relative;
            border: 2px dashed transparent;
            transition: all 0.3s ease;
            min-height: 150px;
            text-align: justify;
        }

        .text-display.active {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.05);
        }

        .typing-area {
            width: 100%;
            min-height: 250px;
            padding: 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-lg);
            font-size: 1.2rem;
            resize: vertical;
            transition: all 0.3s ease;
            background: white;
            line-height: 1.8;
        }

        body.dark-mode .typing-area {
            background: var(--dark);
            color: var(--text-primary);
            border-color: #4a5568;
        }

        .typing-area:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* لوحة الإحصائيات المحسنة */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--bg-light) 0%, white 100%);
            padding: 2rem;
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .stat-card {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* شريط التقدم */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: var(--radius-full);
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: var(--radius-full);
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* نظام النجوم */
        .rating {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: 1.5rem 0;
        }

        .star {
            font-size: 2rem;
            color: #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .star.filled {
            color: #ffd700;
            animation: starPulse 0.5s ease;
        }

        @keyframes starPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* الإشعارات المحسنة */
        .notification {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 1.5rem 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 90%;
            min-width: 300px;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .notification.success {
            border-right: 6px solid var(--success);
        }

        .notification.error {
            border-right: 6px solid var(--danger);
        }

        .notification.info {
            border-right: 6px solid var(--info);
        }

        .notification.warning {
            border-right: 6px solid var(--warning);
        }

        /* بطاقات التحديات */
        .challenge-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .challenge-card {
            background: var(--light);
        }

        .challenge-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--secondary-gradient);
        }

        .challenge-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .challenge-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .challenge-badge {
            background: var(--warning-gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .challenge-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .challenge-rewards {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
        }

        .challenge-points {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--warning);
        }

        /* لوحة المتصدرين */
        .leaderboard {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            margin-top: 3rem;
            box-shadow: var(--shadow-md);
        }

        body.dark-mode .leaderboard {
            background: var(--light);
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 1.2rem;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .leaderboard-table th {
            background: var(--bg-light);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .leaderboard-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .rank-1 { color: #ffd700; font-size: 1.5rem; }
        .rank-2 { color: #c0c0c0; font-size: 1.3rem; }
        .rank-3 { color: #cd7f32; font-size: 1.2rem; }

        /* الملف الشخصي */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 3rem;
            margin-bottom: 3rem;
            padding: 3rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: var(--radius-lg);
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: var(--radius-full);
            border: 5px solid white;
            box-shadow: var(--shadow-lg);
            object-fit: cover;
        }

        .profile-info h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .profile-stats {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .profile-stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* الشارات والإنجازات */
        .badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .badge {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 140px;
        }

        body.dark-mode .badge {
            background: var(--light);
            border-color: #4a5568;
        }

        .badge:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        .badge-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .badge-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .badge-description {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        /* النصوص المفضلة */
        .favorites-list {
            display: grid;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .favorite-item {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        body.dark-mode .favorite-item {
            background: var(--light);
        }

        .favorite-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .favorite-text {
            flex: 1;
            margin-left: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .favorite-actions {
            display: flex;
            gap: 1rem;
        }

        /* النوافذ المنبثقة */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 3rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        body.dark-mode .modal-content {
            background: var(--light);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* حقول النماذج */
        .form-group {
            margin-bottom: 2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: white;
            color: var(--text-primary);
        }

        body.dark-mode .form-control {
            background: var(--dark);
            border-color: #4a5568;
            color: var(--text-primary);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* تبويبات المصادقة */
        .auth-tabs {
            display: flex;
            margin-bottom: 2.5rem;
            background: var(--bg-light);
            border-radius: var(--radius-md);
            padding: 0.5rem;
        }

        body.dark-mode .auth-tabs {
            background: #2d3748;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .auth-tab.active {
            background: var(--primary-gradient);
            color: white;
        }

        /* رسائل الخطأ */
        .error-message {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* صفحة سياسة الخصوصية */
        .privacy-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 3rem;
            box-shadow: var(--shadow-md);
            line-height: 1.8;
            margin-top: 100px;
        }

        body.dark-mode .privacy-content {
            background: var(--light);
        }

        .privacy-content h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        .privacy-content h3 {
            color: var(--secondary);
            margin: 2rem 0 1rem;
            font-size: 1.5rem;
        }

        .privacy-content ul {
            margin-right: 2rem;
            margin-bottom: 1.5rem;
        }

        .privacy-content li {
            margin-bottom: 0.75rem;
        }

        /* صفحة الدعم */
        .support-section {
            padding: 4rem 0;
            margin-top: 100px;
        }

        .support-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-top: 3rem;
        }

        .support-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 3rem;
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: all 0.3s ease;
        }

        body.dark-mode .support-card {
            background: var(--light);
        }

        .support-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .support-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .support-card h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .support-card p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* نظام التذكيرات */
        .reminder-settings {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: var(--shadow-md);
        }

        body.dark-mode .reminder-settings {
            background: var(--light);
        }

        .reminder-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .reminder-option:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--primary);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            right: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(-30px);
        }

        /* مشاركة الإنجازات */
        .share-modal {
            max-width: 500px;
        }

        .share-options {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .share-btn {
            padding: 1rem;
            border-radius: var(--radius-full);
            color: white;
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .share-btn:hover {
            transform: scale(1.1);
        }

        .share-facebook { background: #3b5998; }
        .share-twitter { background: #1da1f2; }
        .share-whatsapp { background: #25d366; }

        /* تصميم متجاوب */
        @media (max-width: 1024px) {
            .navbar-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                justify-content: center;
            }
            
            .hero h1 {
                font-size: 3rem;
            }
            
            .hero p {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .logo i {
                font-size: 2rem;
            }
            
            .nav-links {
                flex-direction: column;
                gap: 0.5rem;
                width: 100%;
            }
            
            .nav-links a {
                text-align: center;
            }
            
            .hero {
                padding: 6rem 1rem 3rem;
                margin-top: 60px;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .achievement-grid {
                grid-template-columns: 1fr;
            }
            
            .training-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-stats {
                justify-content: center;
            }
            
            .support-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 2rem;
            }
            
            .favorite-item {
                flex-direction: column;
                gap: 1rem;
            }
            
            .favorite-actions {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats-panel {
                grid-template-columns: 1fr;
            }
            
            .challenge-rewards {
                flex-direction: column;
                gap: 1rem;
            }
            
            .share-options {
                flex-direction: column;
            }
        }

        /* تأثيرات الحركة */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .slide-in-left {
            opacity: 0;
            transform: translateX(-50px);
            transition: all 0.8s ease;
        }

        .slide-in-left.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .slide-in-right {
            opacity: 0;
            transform: translateX(50px);
            transition: all 0.8s ease;
        }

        .slide-in-right.visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* تحميل النصوص */
        .text-loader {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .text-loader i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* مؤشر التقدم الكبير */
        .progress-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0deg, var(--primary) var(--progress), #e2e8f0 var(--progress), #e2e8f0 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: 2rem auto;
        }

        .progress-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            background: white;
            border-radius: 50%;
        }

        .progress-circle span {
            position: relative;
            z-index: 1;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* زر المشاركة */
        .share-achievement {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: var(--success-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .share-achievement:hover {
            transform: scale(1.1);
        }

        /* رسائل الترحيب */
        .welcome-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 3rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            text-align: center;
            z-index: 4000;
            animation: welcomeAnimation 0.5s ease;
        }

        body.dark-mode .welcome-message {
            background: var(--light);
        }

        @keyframes welcomeAnimation {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .welcome-message h2 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .welcome-message .btn {
            margin-top: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- شريط التنقل الثابت -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <i class="fas fa-keyboard"></i>
                <span>نبض الحروف</span>
            </div>
            
            <ul class="nav-links">
                <li><a href="#home" class="active">الرئيسية</a></li>
                <li><a href="#training">التدريب</a></li>
                <li><a href="#challenges">التحديات</a></li>
                <li><a href="#stats">الإحصائيات</a></li>
                <li><a href="#profile">حسابي</a></li>
                <li><a href="#privacy">سياسة الخصوصية</a></li>
                <li><a href="#support">الدعم</a></li>
            </ul>
            
            <div class="nav-actions" id="navActions">
                <!-- سيتم تحديثها ديناميكياً -->
            </div>
        </div>
    </nav>

    <!-- الصفحة الرئيسية -->
    <section id="home">
        <div class="hero">
            <div class="hero-content">
                <h1>أتقن فن الكتابة السريعة</h1>
                <p>طور مهاراتك في الكتابة بالعربية والإنجليزية مع نظام تدريب تفاعلي وممتع</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" onclick="navigateTo('training')">
                        <i class="fas fa-rocket"></i>
                        ابدأ التدريب الآن
                    </button>
                    <button class="btn btn-outline" onclick="navigateTo('challenges')">
                        <i class="fas fa-trophy"></i>
                        التحديات
                    </button>
                </div>
            </div>
        </div>
        
        <div class="achievements">
            <div class="container">
                <h2 class="section-title fade-in">آخر الإنجازات</h2>
                <div class="achievement-grid">
                    <div class="achievement-card fade-in">
                        <div class="achievement-header">
                            <div class="achievement-icon primary">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div>
                                <h3>أحمد محمد</h3>
                                <p>حقق سرعة 95 كلمة/دقيقة</p>
                            </div>
                        </div>
                        <div class="rating">
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                        </div>
                    </div>
                    
                    <div class="achievement-card fade-in">
                        <div class="achievement-header">
                            <div class="achievement-icon success">
                                <i class="fas fa-medal"></i>
                            </div>
                            <div>
                                <h3>سارة أحمد</h3>
                                <p>أكملت 15 تحدياً متتالياً</p>
                            </div>
                        </div>
                        <div class="rating">
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star"></i>
                        </div>
                    </div>
                    
                    <div class="achievement-card fade-in">
                        <div class="achievement-header">
                            <div class="achievement-icon warning">
                                <i class="fas fa-fire"></i>
                            </div>
                            <div>
                                <h3>محمد علي</h3>
                                <p>تحسن بنسبة 60% هذا الشهر</p>
                            </div>
                        </div>
                        <div class="rating">
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                            <i class="fas fa-star star filled"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- صفحة التدريب -->
    <section id="training" style="display:none;">
        <div class="container">
            <div class="training-container">
                <div class="training-header">
                    <h2>التدريب على الكتابة</h2>
                    
                    <div class="language-selector">
                        <button class="lang-btn active" onclick="selectLanguage('ar')">العربية</button>
                        <button class="lang-btn" onclick="selectLanguage('en')">English</button>
                    </div>
                    
                    <div class="difficulty-selector">
                        <label>المستوى:</label>
                        <select id="difficulty" onchange="loadText()">
                            <option value="beginner">مبتدئ</option>
                            <option value="intermediate">متوسط</option>
                            <option value="advanced">محترف</option>
                            <option value="expert">خبير</option>
                        </select>
                    </div>

                    <div class="text-selector">
                        <label>طول النص:</label>
                        <button class="text-length-btn active" onclick="selectTextLength('short')">قصير</button>
                        <button class="text-length-btn" onclick="selectTextLength('medium')">متوسط</button>
                        <button class="text-length-btn" onclick="selectTextLength('long')">طويل</button>
                    </div>
                </div>
                
                <div class="text-display" id="textDisplay">
                    <div class="text-loader">
                        <i class="fas fa-spinner"></i>
                        <p>جاري تحميل النص...</p>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                
                <textarea class="typing-area" id="typingArea" placeholder="ابدأ الكتابة هنا..."></textarea>
                
                <div class="stats-panel">
                    <div class="stat-card">
                        <div class="stat-label">السرعة</div>
                        <div class="stat-value" id="wpm">0</div>
                        <div class="stat-label">كلمة/دقيقة</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">الدقة</div>
                        <div class="stat-value" id="accuracy">100%</div>
                        <div class="stat-label">دقة</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">الأخطاء</div>
                        <div class="stat-value" id="errors">0</div>
                        <div class="stat-label">خطأ</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">الوقت</div>
                        <div class="stat-value" id="timer">00:00</div>
                        <div class="stat-label">دقيقة</div>
                    </div>
                </div>
                
                <div class="training-controls">
                    <button class="btn btn-primary" onclick="startTraining()">
                        <i class="fas fa-play"></i>
                        ابدأ التدريب
                    </button>
                    <button class="btn btn-secondary" onclick="resetTraining()">
                        <i class="fas fa-redo"></i>
                        إعادة
                    </button>
                    <button class="btn btn-warning" onclick="startSpeedChallenge()">
                        <i class="fas fa-bolt"></i>
                        تحدي السرعة
                    </button>
                    <button class="btn btn-outline" onclick="toggleSound()">
                        <i class="fas fa-volume-up" id="soundIcon"></i>
                    </button>
                    <button class="btn btn-success" onclick="saveToFavorites()">
                        <i class="fas fa-heart"></i>
                        حفظ
                    </button>
                </div>
                
                <div class="rating" id="trainingRating">
                    <i class="fas fa-star star"></i>
                    <i class="fas fa-star star"></i>
                    <i class="fas fa-star star"></i>
                    <i class="fas fa-star star"></i>
                    <i class="fas fa-star star"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- صفحة التحديات -->
    <section id="challenges" style="display:none;">
        <div class="container">
            <h2 class="section-title">التحديات</h2>
            
            <div class="challenge-tabs">
                <button class="btn btn-primary" onclick="loadChallenges('daily')">تحديات يومية</button>
                <button class="btn btn-outline" onclick="loadChallenges('weekly')">تحديات أسبوعية</button>
                <button class="btn btn-outline" onclick="loadChallenges('monthly')">تحديات شهرية</button>
            </div>
            
            <div class="challenges-list" id="challengesList">
                <!-- سيتم تحميلها ديناميكياً -->
            </div>
            
            <div class="leaderboard">
                <h3 class="section-title">لوحة المتصدرين</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>المركز</th>
                            <th>اللاعب</th>
                            <th>السرعة</th>
                            <th>الدقة</th>
                            <th>النقاط</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- سيتم تحميلها ديناميكياً -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- صفحة الإحصائيات -->
    <section id="stats" style="display:none;">
        <div class="container">
            <h2 class="section-title">إحصائيات التقدم</h2>
            
            <div class="stats-summary">
                <div class="stat-card">
                    <div class="stat-label">المستوى الحالي</div>
                    <div class="stat-value" id="currentLevel">مبتدئ</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="levelProgress" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">معدل التحسن الشهري</div>
                    <div class="stat-value" id="monthlyImprovement">+0%</div>
                    <div class="stat-label">تحسن</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">أفضل سرعة</div>
                    <div class="stat-value" id="bestSpeed">0</div>
                    <div class="stat-label">كلمة/دقيقة</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">إجمالي الجلسات</div>
                    <div class="stat-value" id="totalSessions">0</div>
                    <div class="stat-label">جلسة</div>
                </div>
            </div>
            
            <div style="background: white; padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); margin: 2rem 0;">
                <canvas id="progressChart"></canvas>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="exportStats()">
                    <i class="fas fa-download"></i>
                    تصدير تقرير PDF
                </button>
                <button class="btn btn-info" onclick="shareProgress()">
                    <i class="fas fa-share-alt"></i>
                    مشاركة التقدم
                </button>
            </div>
        </div>
    </section>

    <!-- صفحة الحساب الشخصي -->
    <section id="profile" style="display:none;">
        <div class="container">
            <div class="profile-header">
                <img src="https://via.placeholder.com/150" alt="الصورة الشخصية" class="profile-avatar">
                <div class="profile-info">
                    <h2 id="userName">اسم المستخدم</h2>
                    <p>عضو منذ <span id="memberSince">يناير 2024</span></p>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="userLevel">مبتدئ</div>
                            <div class="profile-stat-label">المستوى</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="userPoints">0</div>
                            <div class="profile-stat-label">نقطة</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="userStreak">0</div>
                            <div class="profile-stat-label">أيام متتالية</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="profile-details" style="background: white; padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); margin-bottom: 2rem;">
                <h3>تعديل البيانات الشخصية</h3>
                <div class="form-group">
                    <label>الاسم الكامل</label>
                    <input type="text" id="nameInput" class="form-control">
                </div>
                <div class="form-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="emailInput" class="form-control">
                </div>
                <div class="form-group">
                    <label>كلمة المرور الجديدة</label>
                    <input type="password" id="passwordInput" placeholder="اتركها فارغة إذا لم ترد التغيير" class="form-control">
                </div>
                <button class="btn btn-primary" onclick="saveProfile()">
                    <i class="fas fa-save"></i>
                    حفظ التغييرات
                </button>
            </div>
            
            <div class="reminder-settings">
                <h3>إعدادات التذكير</h3>
                <div class="reminder-option">
                    <div>
                        <h4>تذكير يومي</h4>
                        <p>تذكيرني بالتدريب كل يوم</p>
                    </div>
                    <div class="toggle-switch" id="dailyReminder" onclick="toggleReminder('daily')"></div>
                </div>
                <div class="reminder-option">
                    <div>
                        <h4>تذكير أسبوعي</h4>
                        <p>تلخيص التقدم أسبوعياً</p>
                    </div>
                    <div class="toggle-switch" id="weeklyReminder" onclick="toggleReminder('weekly')"></div>
                </div>
            </div>
            
            <div class="achievements-section">
                <h3 class="section-title">إنجازاتي</h3>
                <div class="badges-container" id="userBadges">
                    <!-- سيتم تحميلها ديناميكياً -->
                </div>
            </div>
            
            <div class="favorites-section">
                <h3 class="section-title">نصوصي المفضلة</h3>
                <div class="favorites-list" id="favoritesList">
                    <!-- سيتم تحميلها ديناميكياً -->
                </div>
            </div>
        </div>
    </section>

    <!-- صفحة سياسة الخصوصية -->
    <section id="privacy" style="display:none;">
        <div class="container">
            <div class="privacy-content">
                <h2>سياسة الخصوصية</h2>
                <p>آخر تحديث: <span id="privacyUpdateDate">يناير 2024</span></p>
                
                <h3>مقدمة</h3>
                <p>نحن في "نبض الحروف" نلتزم بحماية خصوصيتك وبياناتك الشخصية. توضح هذه السياسة كيفية جمعنا واستخدامنا وحمايتنا لمعلوماتك عند استخدامك لموقعنا.</p>
                
                <h3>المعلومات التي نجمعها</h3>
                <ul>
                    <li><strong>المعلومات الشخصية:</strong> الاسم، البريد الإلكتروني، كلمة المرور</li>
                    <li><strong>بيانات الأداء:</strong> سرعة الكتابة، الدقة، الإحصائيات</li>
                    <li><strong>بيانات الاستخدام:</strong> تاريخ الدخول، المدة، الصفحات المزارة</li>
                    <li><strong>بيانات التقنية:</strong> نوع المتصفح، نظام التشغيل، عنوان IP</li>
                </ul>
                
                <h3>كيفية استخدام المعلومات</h3>
                <ul>
                    <li>تقديم وتحسين خدماتنا</li>
                    <li>تخصيص تجربة المستخدم</li>
                    <li>تحليل الأداء والإحصائيات</li>
                    <li>التواصل مع المستخدمين</li>
                    <li>ضمان أمن الموقع</li>
                </ul>
                
                <h3>حماية البيانات</h3>
                <p>نستخدم تشفيراً متقدماً لحماية بياناتك:</p>
                <ul>
                    <li>تشفير كلمات المرور باستخدام خوارزميات آمنة</li>
                    <li>اتصالات HTTPS آمنة</li>
                    <li>تخزين البيانات محلياً في متصفح المستخدم</li>
                    <li>عدم مشاركة البيانات مع أطراف ثالثة</li>
                </ul>
                
                <h3>حقوق المستخدم</h3>
                <ul>
                    <li>الوصول إلى بياناتك الشخصية</li>
                    <li>تصحيح أو تحديث معلوماتك</li>
                    <li>حذف حسابك وبياناتك</li>
                    <li>تصدير بياناتك</li>
                    <li>إيقاف جمع البيانات</li>
                </ul>
                
                <h3>ملفات تعريف الارتباط (Cookies)</h3>
                <p>نستخدم ملفات تعريف الارتباط لتحسين تجربتك:</p>
                <ul>
                    <li>تذكر حالة تسجيل الدخول</li>
                    <li>حفظ التفضيلات (الوضع الليلي، الصوت)</li>
                    <li>تحليل استخدام الموقع</li>
                    <li>تخصيص المحتوى</li>
                </ul>
                
                <h3>التغييرات على هذه السياسة</h3>
                <p>قد نقوم بتحديث هذه السياسة من وقت لآخر. سيتم نشر أي تغييرات على هذه الصفحة مع تحديث تاريخ آخر مراجعة.</p>
                
                <h3>اتصل بنا</h3>
                <p>إذا كان لديك أي أسئلة حول سياسة الخصوصية، يرجى التواصل معنا عبر:</p>
                <ul>
                    <li>البريد الإلكتروني: privacy@nabz-alhorof.com</li>
                    <li>صفحة الدعم: <a href="#support" onclick="navigateTo('support')">اضغط هنا</a></li>
                </ul>
            </div>
        </div>
    </section>

    <!-- صفحة الدعم -->
    <section id="support" style="display:none;">
        <div class="container">
            <h2 class="section-title">الدعم والمساعدة</h2>
            
            <div class="support-grid">
                <div class="support-card">
                    <div class="support-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3>دليل المستخدم</h3>
                    <p>تعلم كيفية استخدام جميع ميزات الموقع بسهولة من خلال دليلنا الشامل خطوة بخطوة.</p>
                    <button class="btn btn-primary" onclick="showUserGuide()">اقرأ الدليل</button>
                </div>
                
                <div class="support-card">
                    <div class="support-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <h3>الأسئلة الشائعة</h3>
                    <p>أجوبة على أكثر الأسئلة تكراراً من المستخدمين حول استخدام الموقع وحل المشكلات.</p>
                    <button class="btn btn-primary" onclick="showFAQ()">عرض الأسئلة</button>
                </div>
                
                <div class="support-card">
                    <div class="support-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <h3>اتصل بنا</h3>
                    <p>تواصل مع فريق الدعم للحصول على مساعدة شخصية أو الإبلاغ عن مشكلة تقنية.</p>
                    <button class="btn btn-primary" onclick="showContactForm()">راسلنا</button>
                </div>
                
                <div class="support-card">
                    <div class="support-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <h3>الإبلاغ عن خطأ</h3>
                    <p>ساعدنا في تحسين الموقع بالإبلاغ عن أي أخطاء أو مشكلات تواجهها أثناء الاستخدام.</p>
                    <button class="btn btn-primary" onclick="showBugReport()">أبلغ عن خطأ</button>
                </div>
                
                <div class="support-card">
                    <div class="support-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h3>اقتراحات</h3>
                    <p>لديك فكرة لتحسين الموقع؟ شاركنا اقتراحاتك وملاحظاتك لمساعدتنا على التطور.</p>
                    <button class="btn btn-primary" onclick="showSuggestionForm()">شارك اقتراحك</button>
                </div>
                
                <div class="support-card">
                    <div class="support-icon">
                        <i class="fas fa-video"></i>
                    </div>
                    <h3>دروس فيديو</h3>
                    <p>شاهد دروس فيديو تعليمية لتحسين مهارات الكتابة والاستفادة من جميع ميزات الموقع.</p>
                    <button class="btn btn-primary" onclick="showVideoTutorials()">شاهد الدروس</button>
                </div>
            </div>
        </div>
    </section>

    <!-- نافذة تسجيل الدخول والتسجيل -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAuthModal()">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">تسجيل الدخول</div>
                <div class="auth-tab" onclick="switchAuthTab('register')">إنشاء حساب</div>
            </div>
            
            <!-- نموذج تسجيل الدخول -->
            <form id="loginForm" style="display: block;">
                <h2>مرحباً بك مجدداً</h2>
                <div class="form-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="loginEmail" required class="form-control" placeholder="أدخل بريدك الإلكتروني">
                    <div class="error-message" id="loginEmailError">البريد الإلكتروني مطلوب</div>
                </div>
                <div class="form-group">
                    <label>كلمة المرور</label>
                    <input type="password" id="loginPassword" required class="form-control" placeholder="أدخل كلمة المرور">
                    <div class="error-message" id="loginPasswordError">كلمة المرور مطلوبة</div>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i>
                    تسجيل الدخول
                </button>
                <p style="text-align: center; margin-top: 1rem;">
                    <a href="#" onclick="switchAuthTab('register')">ليس لديك حساب؟ سجل الآن</a>
                </p>
            </form>
            
            <!-- نموذج التسجيل -->
            <form id="registerForm" style="display: none;">
                <h2>إنشاء حساب جديد</h2>
                <div class="form-group">
                    <label>الاسم الكامل</label>
                    <input type="text" id="registerName" required class="form-control" placeholder="أدخل اسمك الكامل">
                    <div class="error-message" id="registerNameError">الاسم مطلوب</div>
                </div>
                <div class="form-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="registerEmail" required class="form-control" placeholder="أدخل بريدك الإلكتروني">
                    <div class="error-message" id="registerEmailError">البريد الإلكتروني مطلوب</div>
                </div>
                <div class="form-group">
                    <label>كلمة المرور</label>
                    <input type="password" id="registerPassword" required class="form-control" placeholder="أدخل كلمة المرور" minlength="6">
                    <div class="error-message" id="registerPasswordError">كلمة المرور يجب أن تكون 6 أحرف على الأقل</div>
                </div>
                <div class="form-group">
                    <label>تأكيد كلمة المرور</label>
                    <input type="password" id="registerConfirmPassword" required class="form-control" placeholder="أعد إدخال كلمة المرور">
                    <div class="error-message" id="registerConfirmPasswordError">كلمتا المرور غير متطابقتين</div>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-user-plus"></i>
                    إنشاء حساب
                </button>
                <p style="text-align: center; margin-top: 1rem;">
                    <a href="#" onclick="switchAuthTab('login')">لديك حساب بالفعل؟ سجل دخول</a>
                </p>
            </form>
        </div>
    </div>

    <!-- نافذة مشاركة الإنجازات -->
    <div id="shareModal" class="modal">
        <div class="modal-content share-modal">
            <button class="modal-close" onclick="closeShareModal()">
                <i class="fas fa-times"></i>
            </button>
            <h2>مشاركة إنجازاتك</h2>
            <p>شارك تقدمك مع أصدقائك على وسائل التواصل الاجتماعي</p>
            <div class="share-options">
                <a href="#" class="share-btn share-facebook" onclick="shareOnFacebook()">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="share-btn share-twitter" onclick="shareOnTwitter()">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="share-btn share-whatsapp" onclick="shareOnWhatsApp()">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- إشعارات النظام -->
    <div id="notification" class="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">تم الحفظ بنجاح!</span>
    </div>

    <!-- زر المشاركة العائم -->
    <button class="share-achievement" onclick="showShareModal()" title="مشاركة الإنجازات">
        <i class="fas fa-share-alt"></i>
    </button>

    <script>
        // نظام المستخدمين المتقدم
        class UserManager {
            constructor() {
                this.users = this.loadUsers();
                this.currentUser = this.loadCurrentUser();
                this.textsDB = this.generateTextsDB();
            }

            // تحميل المستخدمين من التخزين المحلي
            loadUsers() {
                const users = localStorage.getItem('users');
                return users ? JSON.parse(users) : [];
            }

            // حفظ المستخدمين في التخزين المحلي
            saveUsers() {
                localStorage.setItem('users', JSON.stringify(this.users));
            }

            // تحميل المستخدم الحالي
            loadCurrentUser() {
                const user = localStorage.getItem('currentUser');
                return user ? JSON.parse(user) : null;
            }

            // توليد قاعدة بيانات النصوص الضخمة
            generateTextsDB() {
                return {
                    ar: {
                        beginner: this.generateArabicTexts('beginner', 10000, 120000),
                        intermediate: this.generateArabicTexts('intermediate', 10000, 120000),
                        advanced: this.generateArabicTexts('advanced', 10000, 120000),
                        expert: this.generateArabicTexts('expert', 10000, 120000)
                    },
                    en: {
                        beginner: this.generateEnglishTexts('beginner', 10000, 120000),
                        intermediate: this.generateEnglishTexts('intermediate', 10000, 120000),
                        advanced: this.generateEnglishTexts('advanced', 10000, 120000),
                        expert: this.generateEnglishTexts('expert', 10000, 120000)
                    }
                };
            }

            // توليد نصوص عربية
            generateArabicTexts(level, wordCount, sentenceCount) {
                const words = {
                    beginner: ['القط', 'الكلب', 'البيت', 'المدرسة', 'الكتاب', 'القلم', 'الورقة', 'الطالب', 'المعلم', 'الشمس', 'القمر', 'النجوم', 'السماء', 'الأرض', 'الماء'],
                    intermediate: ['التعليم', 'التكنولوجيا', 'التطور', 'الابتكار', 'الإبداع', 'التحدي', 'النجاح', 'التقدم', 'المستقبل', 'الحاضر', 'الماضي', 'الأمل', 'العمل', 'الجهد', 'المثابرة'],
                    advanced: ['الاستدامة', 'الرقمية', 'التحول', 'الاستراتيجية', 'التنافسية', 'الابتكارية', 'الريادة', 'التميز', 'الجودة', 'الكفاءة', 'الفعالية', 'الإنتاجية', 'التنمية', 'الازدهار', 'الازدهار'],
                    expert: ['الاستشراف', 'الاستدامة', 'الرقمنة', 'التحول الرقمي', 'الثورة الصناعية الرابعة', 'الذكاء الاصطناعي', 'التعلم الآلي', 'التحليلات المتقدمة', 'الابتكار المفتوح', 'الاقتصاد المعرفي', 'المجتمع الرقمي', 'التحول الثقافي', 'التنمية المستدامة', 'الابتكار التكنولوجي']
                };

                const sentences = {
                    beginner: [
                        'القط يجري في الحديقة.',
                        'الشمس مشرقة اليوم.',
                        'الطالب يقرأ الكتاب.',
                        'المعلم يشرح الدرس.',
                        'الكلب يلعب في الحديقة.',
                        'القلم يكتب على الورقة.',
                        'النجوم تلمع في السماء.',
                        'الماء يروي الزرع.',
                        'الأرض تدور حول الشمس.',
                        'القمر يضيء الليل.'
                    ],
                    intermediate: [
                        'التكنولوجيا غيرت طريقة حياتنا بشكل جذري.',
                        'التعليم المستمر هو مفتاح النجاح في العصر الحديث.',
                        'الابتكار يحتاج إلى تفكير إبداعي وشجاعة.',
                        'التحديات تجعلنا أقوى وأكثر قدرة على التكيف.',
                        'النجاح يتطلب عمل جاد ومثابرة.',
                        'التقدم لا يأتي إلا بالجهد والمثابرة.',
                        'الأمل يضيء الطريق في أحلك الظروف.',
                        'العمل الجماعي يحقق نتائج أفضل.',
                        'المعرفة قوة تغير حياتنا.',
                        'الابتكار هو محرك التطور.'
                    ],
                    advanced: [
                        'الاستدامة البيئية أصبحت ضرورة ملحة في عالمنا اليوم.',
                        'التحول الرقمي يعيد تشكيل جميع جوانب حياتنا اليومية.',
                        'الذكاء الاصطناعي يفتح آفاقاً جديدة للابتكار والتطور.',
                        'التعلم الآلي يحلل البيانات ويوفر رؤى قيمة للأعمال.',
                        'الاقتصاد المعرفي يعتمد على المعلومات والابتكار.',
                        'التنمية المستدامة توازن بين النمو الاقتصادي وحماية البيئة.',
                        'الثورة الصناعية الرابعة تغير مفهوم العمل والإنتاج.',
                        'الابتكار المفتوح يعزز التعاون بين المؤسسات والأفراد.',
                        'المجتمع الرقمي يتطلب مهارات جديدة وثقافة مختلفة.',
                        'التحول الثقافي ضروري لتبني التكنولوجيا الحديثة.'
                    ],
                    expert: [
                        'الاستشراف المستقبلي يتطلب تحليل الاتجاهات العالمية وتوقع التغيرات.',
                        'الرقمنة الشاملة تعيد تعريف مفاهيم الاقتصاد والمجتمع والثقافة.',
                        'الثورة الصناعية الرابعة تمثل دمج التقنيات المادية والرقمية والبيولوجية.',
                        'الذكاء الاصطناعي المتقدم لديه القدرة على التعلم والتكيف واتخاذ القرارات.',
                        'التعلم الآلي العميق يحلل البيانات المعقدة ويكتشف الأنماط المخفية.',
                        'الابتكار التكنولوجي المتسارع يتطلب استراتيجيات تكيفية مرنة.',
                        'الاقتصاد المعرفي القائم على الابتكار يحتاج إلى أنظمة تعليمية متطورة.',
                        'التنمية المستدامة تتطلب تكاملاً بين الأبعاد الاقتصادية والاجتماعية والبيئية.',
                        'التحول الرقمي الناجح يعتمد على القيادة الرشيدة والاستثمار في المهارات.',
                        'المجتمع الرقمي المتوازن يوفر الفرص للجميع مع حماية الخصوصية والحقوق.'
                    ]
                };

                // توليد نصوص عشوائية بناءً على المستوى
                const generatedTexts = [];
                const levelWords = words[level];
                const levelSentences = sentences[level];

                for (let i = 0; i < sentenceCount; i++) {
                    const sentence = levelSentences[Math.floor(Math.random() * levelSentences.length)];
                    generatedTexts.push(sentence);
                }

                // إضافة كلمات إضافية للوصول للعدد المطلوب
                let totalWords = generatedTexts.join(' ').split(' ').length;
                while (totalWords < wordCount) {
                    const randomWord = levelWords[Math.floor(Math.random() * levelWords.length)];
                    generatedTexts.push(randomWord);
                    totalWords++;
                }

                return generatedTexts;
            }

            // توليد نصوص إنجليزية
            generateEnglishTexts(level, wordCount, sentenceCount) {
                const words = {
                    beginner: ['cat', 'dog', 'house', 'school', 'book', 'pen', 'paper', 'student', 'teacher', 'sun', 'moon', 'stars', 'sky', 'earth', 'water'],
                    intermediate: ['education', 'technology', 'development', 'innovation', 'creativity', 'challenge', 'success', 'progress', 'future', 'present', 'past', 'hope', 'work', 'effort', 'perseverance'],
                    advanced: ['sustainability', 'digital', 'transformation', 'strategy', 'competitiveness', 'innovation', 'leadership', 'excellence', 'quality', 'efficiency', 'effectiveness', 'productivity', 'development', 'prosperity', 'growth'],
                    expert: ['foresight', 'sustainability', 'digitization', 'digital transformation', 'fourth industrial revolution', 'artificial intelligence', 'machine learning', 'advanced analytics', 'open innovation', 'knowledge economy', 'digital society', 'cultural transformation', 'sustainable development', 'technological innovation']
                };

                const sentences = {
                    beginner: [
                        'The cat runs in the garden.',
                        'The sun is shining today.',
                        'The student reads the book.',
                        'The teacher explains the lesson.',
                        'The dog plays in the garden.',
                        'The pen writes on the paper.',
                        'The stars shine in the sky.',
                        'Water waters the plants.',
                        'Earth revolves around the sun.',
                        'The moon lights the night.'
                    ],
                    intermediate: [
                        'Technology has changed our lives dramatically.',
                        'Continuous learning is the key to success in the modern age.',
                        'Innovation requires creative thinking and courage.',
                        'Challenges make us stronger and more adaptable.',
                        'Success requires hard work and perseverance.',
                        'Progress comes only through effort and persistence.',
                        'Hope lights the way in the darkest conditions.',
                        'Teamwork achieves better results.',
                        'Knowledge is power that changes our lives.',
                        'Innovation is the driver of progress.'
                    ],
                    advanced: [
                        'Environmental sustainability has become an urgent necessity in our world today.',
                        'Digital transformation is reshaping all aspects of our daily lives.',
                        'Artificial intelligence opens new horizons for innovation and development.',
                        'Machine learning analyzes data and provides valuable insights for businesses.',
                        'The knowledge economy relies on information and innovation.',
                        'Sustainable development balances economic growth with environmental protection.',
                        'The Fourth Industrial Revolution is changing the concept of work and production.',
                        'Open innovation enhances collaboration between institutions and individuals.',
                        'The digital society requires new skills and a different culture.',
                        'Cultural transformation is necessary to adopt modern technology.'
                    ],
                    expert: [
                        'Future foresight requires analyzing global trends and anticipating changes.',
                        'Comprehensive digitization redefines the concepts of economy, society, and culture.',
                        'The Fourth Industrial Revolution represents the integration of physical, digital, and biological technologies.',
                        'Advanced artificial intelligence has the ability to learn, adapt, and make decisions.',
                        'Deep machine learning analyzes complex data and discovers hidden patterns.',
                        'Accelerated technological innovation requires adaptive and flexible strategies.',
                        'The innovation-based knowledge economy needs advanced education systems.',
                        'Sustainable development requires integration between economic, social, and environmental dimensions.',
                        'Successful digital transformation depends on wise leadership and investment in skills.',
                        'A balanced digital society provides opportunities for all while protecting privacy and rights.'
                    ]
                };

                // توليد نصوص عشوائية بناءً على المستوى
                const generatedTexts = [];
                const levelWords = words[level];
                const levelSentences = sentences[level];

                for (let i = 0; i < sentenceCount; i++) {
                    const sentence = levelSentences[Math.floor(Math.random() * levelSentences.length)];
                    generatedTexts.push(sentence);
                }

                // إضافة كلمات إضافية للوصول للعدد المطلوب
                let totalWords = generatedTexts.join(' ').split(' ').length;
                while (totalWords < wordCount) {
                    const randomWord = levelWords[Math.floor(Math.random() * levelWords.length)];
                    generatedTexts.push(randomWord);
                    totalWords++;
                }

                return generatedTexts;
            }

            // تسجيل مستخدم جديد
            register(name, email, password) {
                // التحقق من وجود البريد الإلكتروني
                if (this.users.find(u => u.email === email)) {
                    throw new Error('البريد الإلكتروني مسجل بالفعل');
                }

                // إنشاء مستخدم جديد
                const user = {
                    id: Date.now(),
                    name,
                    email,
                    password: this.hashPassword(password),
                    createdAt: new Date().toISOString(),
                    stats: {
                        wpm: [],
                        accuracy: [],
                        errors: [],
                        level: 'beginner',
                        points: 0,
                        sessionsCompleted: 0,
                        bestSpeed: 0,
                        streak: 0,
                        lastTrainingDate: null
                    },
                    preferences: {
                        language: 'ar',
                        theme: 'light',
                        soundEnabled: true,
                        dailyReminder: false,
                        weeklyReminder: false
                    },
                    favorites: [],
                    achievements: ['first_steps'], // إنجاز التسجيل
                    challenges: {
                        daily: [],
                        weekly: [],
                        monthly: []
                    },
                    trainingProgress: {}
                };

                this.users.push(user);
                this.saveUsers();
                return user;
            }

            // تسجيل الدخول
            login(email, password) {
                const user = this.users.find(u => 
                    u.email === email && u.password === this.hashPassword(password)
                );

                if (!user) {
                    throw new Error('البريد الإلكتروني أو كلمة المرور غير صحيحة');
                }

                this.currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                // تحديث السلسلة المتتالية
                this.updateStreak();
                
                return user;
            }

            // تسجيل الخروج
            logout() {
                this.currentUser = null;
                localStorage.removeItem('currentUser');
            }

            // تحديث بيانات المستخدم
            updateUser(userData) {
                const index = this.users.findIndex(u => u.id === this.currentUser.id);
                if (index !== -1) {
                    this.users[index] = { ...this.users[index], ...userData };
                    this.currentUser = this.users[index];
                    this.saveUsers();
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                }
            }

            // تشفير كلمة المرور
            hashPassword(password) {
                return btoa(password + 'nabz_salt_2024');
            }

            // التحقق من صحة البريد الإلكتروني
            isValidEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            // التحقق من قوة كلمة المرور
            isStrongPassword(password) {
                return password.length >= 6;
            }

            // إضافة إنجاز للمستخدم
            addAchievement(achievementId) {
                if (!this.currentUser.achievements.includes(achievementId)) {
                    this.currentUser.achievements.push(achievementId);
                    this.updateUser({ achievements: this.currentUser.achievements });
                    showNotification(`تم الحصول على إنجاز جديد: ${achievementsDB[achievementId]?.name}`, 'success');
                }
            }

            // تحديث إحصائيات المستخدم
            updateStats(wpm, accuracy, errors) {
                this.currentUser.stats.wpm.push(wpm);
                this.currentUser.stats.accuracy.push(accuracy);
                this.currentUser.stats.errors.push(errors);
                this.currentUser.stats.sessionsCompleted++;
                
                if (wpm > this.currentUser.stats.bestSpeed) {
                    this.currentUser.stats.bestSpeed = wpm;
                }

                // حساب النقاط
                const points = Math.round((wpm * accuracy) / 10);
                this.currentUser.stats.points += points;

                // تحديث المستوى
                this.updateLevel();

                // تحديث تاريخ آخر تدريب
                this.currentUser.stats.lastTrainingDate = new Date().toISOString();

                this.updateUser(this.currentUser);
            }

            // تحديث مستوى المستخدم
            updateLevel() {
                const points = this.currentUser.stats.points;
                let level = 'مبتدئ';
                
                if (points >= 10000) level = 'خبير';
                else if (points >= 5000) level = 'محترف';
                else if (points >= 2000) level = 'متوسط';
                
                this.currentUser.stats.level = level;
            }

            // تحديث السلسلة المتتالية
            updateStreak() {
                const today = new Date().toDateString();
                const lastTraining = this.currentUser.stats.lastTrainingDate;
                
                if (lastTraining) {
                    const lastDate = new Date(lastTraining);
                    const diffTime = Math.abs(new Date() - lastDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) {
                        this.currentUser.stats.streak++;
                    } else if (diffDays > 1) {
                        this.currentUser.stats.streak = 1;
                    }
                } else {
                    this.currentUser.stats.streak = 1;
                }
                
                this.updateUser(this.currentUser);
            }

            // حساب معدل التحسن الشهري
            calculateMonthlyImprovement() {
                const wpmHistory = this.currentUser.stats.wpm;
                if (wpmHistory.length < 2) return 0;
                
                const recent = wpmHistory.slice(-4);
                const older = wpmHistory.slice(-8, -4);
                
                if (older.length === 0) return 0;
                
                const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;
                const olderAvg = older.reduce((a, b) => a + b, 0) / older.length;
                
                return Math.round(((recentAvg - olderAvg) / olderAvg) * 100);
            }

            // حفظ تقدم التدريب
            saveTrainingProgress(textId, progress, typedText) {
                this.currentUser.trainingProgress[textId] = {
                    progress,
                    typedText,
                    timestamp: new Date().toISOString()
                };
                this.updateUser(this.currentUser);
            }

            // تحميل تقدم التدريب
            loadTrainingProgress(textId) {
                return this.currentUser.trainingProgress[textId] || null;
            }

            // الحصول على نص عشوائي
            getRandomText(language, difficulty, length) {
                const texts = this.textsDB[language][difficulty];
                let text;
                
                if (length === 'short') {
                    text = texts.slice(0, 5).join(' ');
                } else if (length === 'medium') {
                    text = texts.slice(0, 15).join(' ');
                } else {
                    text = texts.slice(0, 30).join(' ');
                }
                
                return text;
            }
        }

        // إنشاء مدير المستخدمين
        const userManager = new UserManager();

        // قاعدة بيانات التحديات
        const challengesDB = {
            daily: [
                {
                    id: 1,
                    title: "تحدي السرعة القصوى",
                    description: "اكتب 150 كلمة في أقل من دقيقة واحدة",
                    targetWords: 150,
                    timeLimit: 60,
                    points: 200,
                    badge: "speed_demon"
                },
                {
                    id: 2,
                    title: "تحدي الدقة المطلقة",
                    description: "اكتب نصاً طويلاً بدون أخطاء",
                    targetAccuracy: 100,
                    points: 300,
                    badge: "perfectionist"
                },
                {
                    id: 3,
                    title: "تحدي الاستمرارية",
                    description: "تدرب لمدة 30 دقيقة متتالية",
                    timeLimit: 1800,
                    points: 250,
                    badge: "consistent"
                }
            ],
            weekly: [
                {
                    id: 4,
                    title: "تحدي الأسبوع الذهبي",
                    description: "أكمل 7 تحديات يومية هذا الأسبوع",
                    requiredChallenges: 7,
                    points: 1000,
                    badge: "weekly_warrior"
                },
                {
                    id: 5,
                    title: "تحدي التحسن",
                    description: "حقق تحسناً بنسبة 50% في سرعتك",
                    targetImprovement: 50,
                    points: 800,
                    badge: "fast_learner"
                }
            ],
            monthly: [
                {
                    id: 6,
                    title: "تحدي الأسطورة",
                    description: "حقق سرعة 120+ كلمة/دقيقة بدقة 98%+",
                    targetWpm: 120,
                    targetAccuracy: 98,
                    points: 2000,
                    badge: "legend"
                },
                {
                    id: 7,
                    title: "تحدي الولاء",
                    description: "تدرب كل يوم لمدة شهر كامل",
                    requiredDays: 30,
                    points: 1500,
                    badge: "loyal"
                }
            ]
        };

        // قاعدة بيانات الإنجازات
        const achievementsDB = {
            first_steps: { name: "الخطوات الأولى", icon: "fa-baby", description: "أكمل أول جلسة تدريب" },
            speed_demon: { name: "شيطان السرعة", icon: "fa-bolt", description: "حقق سرعة 100+ كلمة/دقيقة" },
            perfectionist: { name: "المثالي", icon: "fa-gem", description: "أكمل تدريب بدون أخطاء" },
            weekly_warrior: { name: "محارب الأسبوع", icon: "fa-shield-alt", description: "أكمل 7 تحديات أسبوعية" },
            legend: { name: "الأسطورة", icon: "fa-crown", description: "حقق أعلى المستويات" },
            consistent: { name: "المثابر", icon: "fa-calendar-check", description: "تدرب لمدة 7 أيام متتالية" },
            fast_learner: { name: "سريع التعلم", icon: "fa-graduation-cap", description: "تحسن بنسبة 50% في أسبوع" },
            loyal: { name: "الوفي", icon: "fa-heart", description: "تدرب لمدة 30 يوم متتالي" }
        };

        // متغيرات عامة
        let currentLanguage = 'ar';
        let currentDifficulty = 'beginner';
        let currentTextLength = 'short';
        let trainingActive = false;
        let startTime;
        let soundEnabled = true;
        let currentChallengeType = 'daily';
        let currentTextId = null;

        // تحديث واجهة المستخدم بناءً على حالة تسجيل الدخول
        function updateAuthUI() {
            const navActions = document.getElementById('navActions');
            
            if (userManager.currentUser) {
                // المستخدم مسجل دخوله
                navActions.innerHTML = `
                    <div class="user-info">
                        <img src="https://via.placeholder.com/40" alt="${userManager.currentUser.name}" class="user-avatar">
                        <div class="user-details">
                            <div class="user-name">${userManager.currentUser.name}</div>
                            <div class="user-level">المستوى: ${userManager.currentUser.stats.level}</div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        خروج
                    </button>
                `;
                
                // تحديث بيانات المستخدم في الصفحة الشخصية
                updateUserProfileUI();
            } else {
                // المستخدم غير مسجل دخوله
                navActions.innerHTML = `
                    <button class="btn btn-primary" onclick="showAuthModal()">
                        <i class="fas fa-user"></i>
                        <span>تسجيل الدخول</span>
                    </button>
                    <button class="btn btn-outline" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i>
                    </button>
                `;
            }
        }

        // تحديث واجهة الملف الشخصي
        function updateUserProfileUI() {
            if (!userManager.currentUser) return;
            
            const user = userManager.currentUser;
            
            // تحديث المعلومات الأساسية
            document.getElementById('userName').textContent = user.name;
            document.getElementById('nameInput').value = user.name;
            document.getElementById('emailInput').value = user.email;
            document.getElementById('userLevel').textContent = user.stats.level;
            document.getElementById('userPoints').textContent = user.stats.points;
            document.getElementById('userStreak').textContent = user.stats.streak;
            document.getElementById('memberSince').textContent = new Date(user.createdAt).toLocaleDateString('ar', { month: 'long', year: 'numeric' });
            
            // تحديث الإحصائيات
            document.getElementById('currentLevel').textContent = user.stats.level;
            document.getElementById('bestSpeed').textContent = user.stats.bestSpeed;
            document.getElementById('totalSessions').textContent = user.stats.sessionsCompleted;
            
            // حساب وتحديث معدل التحسن
            const improvement = userManager.calculateMonthlyImprovement();
            document.getElementById('monthlyImprovement').textContent = `${improvement > 0 ? '+' : ''}${improvement}%`;
            
            // تحديث شريط تقدم المستوى
            const levelProgress = calculateLevelProgress(user.stats.points);
            document.getElementById('levelProgress').style.width = `${levelProgress}%`;
            
            // تحديث الإنجازات
            updateUserBadges();
            
            // تحديث النصوص المفضلة
            updateUserFavorites();
            
            // تحديث إعدادات التذكير
            updateReminderSettings();
        }

        // حساب تقدم المستوى
        function calculateLevelProgress(points) {
            if (points < 2000) return (points / 2000) * 100;
            if (points < 5000) return ((points - 2000) / 3000) * 100;
            if (points < 10000) return ((points - 5000) / 5000) * 100;
            return 100;
        }

        // تحديث شارات المستخدم
        function updateUserBadges() {
            const badgesContainer = document.getElementById('userBadges');
            badgesContainer.innerHTML = '';
            
            userManager.currentUser.achievements.forEach(achievementId => {
                const achievement = achievementsDB[achievementId];
                if (achievement) {
                    const badgeElement = document.createElement('div');
                    badgeElement.className = 'badge';
                    badgeElement.innerHTML = `
                        <div class="badge-icon">
                            <i class="fas ${achievement.icon}"></i>
                        </div>
                        <div class="badge-name">${achievement.name}</div>
                        <div class="badge-description">${achievement.description}</div>
                    `;
                    badgesContainer.appendChild(badgeElement);
                }
            });
            
            // إضافة شارات فارغة للمستقبل
            const totalBadges = Object.keys(achievementsDB).length;
            const emptySlots = totalBadges - userManager.currentUser.achievements.length;
            for (let i = 0; i < emptySlots; i++) {
                const emptyBadge = document.createElement('div');
                emptyBadge.className = 'badge';
                emptyBadge.style.opacity = '0.3';
                emptyBadge.innerHTML = `
                    <div class="badge-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="badge-name">مقفل</div>
                `;
                badgesContainer.appendChild(emptyBadge);
            }
        }

        // تحديث النصوص المفضلة
        function updateUserFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            favoritesList.innerHTML = '';
            
            if (userManager.currentUser.favorites.length === 0) {
                favoritesList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">لا توجد نصوص مفضلة بعد</p>';
                return;
            }
            
            userManager.currentUser.favorites.forEach((text, index) => {
                const favoriteItem = document.createElement('div');
                favoriteItem.className = 'favorite-item';
                favoriteItem.innerHTML = `
                    <div class="favorite-text">${text.substring(0, 100)}${text.length > 100 ? '...' : ''}</div>
                    <div class="favorite-actions">
                        <button class="btn btn-primary" onclick="startFavoriteTraining('${text}')">تدرب</button>
                        <button class="btn btn-outline" onclick="removeFavorite(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                favoritesList.appendChild(favoriteItem);
            });
        }

        // تحديث إعدادات التذكير
        function updateReminderSettings() {
            if (userManager.currentUser.preferences.dailyReminder) {
                document.getElementById('dailyReminder').classList.add('active');
            }
            if (userManager.currentUser.preferences.weeklyReminder) {
                document.getElementById('weeklyReminder').classList.add('active');
            }
        }

        // إزالة نص مفضل
        function removeFavorite(index) {
            userManager.currentUser.favorites.splice(index, 1);
            userManager.updateUser({ favorites: userManager.currentUser.favorites });
            updateUserFavorites();
            showNotification('تم حذف النص من المفضلة', 'info');
        }

        // بدء التدريب على نص مفضل
        function startFavoriteTraining(text) {
            navigateTo('training');
            setTimeout(() => {
                document.getElementById('textDisplay').textContent = text;
                document.getElementById('textDisplay').classList.add('active');
            }, 100);
        }

        // عرض نافذة المصادقة
        function showAuthModal() {
            document.getElementById('authModal').classList.add('show');
        }

        // إغلاق نافذة المصادقة
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('show');
            // إعادة تعيين النماذج
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
            // إخفاء رسائل الخطأ
            document.querySelectorAll('.error-message').forEach(msg => {
                msg.classList.remove('show');
            });
        }

        // تبديل تبويبات المصادقة
        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.auth-tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                tabs[0].classList.add('active');
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                tabs[1].classList.add('active');
            }
        }

        // تسجيل الدخول
        function login(email, password) {
            try {
                const user = userManager.login(email, password);
                updateAuthUI();
                closeAuthModal();
                showNotification(`مرحباً بك مجدداً ${user.name}!`, 'success');
                
                // تطبيق تفضيلات المستخدم
                if (user.preferences.theme === 'dark') {
                    document.body.classList.add('dark-mode');
                }
                soundEnabled = user.preferences.soundEnabled;
                
                // عرض رسالة ترحيب
                showWelcomeMessage(user);
                
                return true;
            } catch (error) {
                showNotification(error.message, 'error');
                return false;
            }
        }

        // عرض رسالة ترحيب
        function showWelcomeMessage(user) {
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'welcome-message';
            welcomeDiv.innerHTML = `
                <h2>مرحباً بك ${user.name}!</h2>
                <p>سعيدون برؤيتك مجدداً. مستعد للتدريب اليوم؟</p>
                <button class="btn btn-primary" onclick="this.parentElement.remove(); navigateTo('training');">
                    ابدأ التدريب
                </button>
            `;
            document.body.appendChild(welcomeDiv);
            
            setTimeout(() => {
                if (welcomeDiv.parentElement) {
                    welcomeDiv.remove();
                }
            }, 5000);
        }

        // تسجيل مستخدم جديد
        function register(name, email, password, confirmPassword) {
            try {
                // التحقق من تطابق كلمتي المرور
                if (password !== confirmPassword) {
                    throw new Error('كلمتا المرور غير متطابقتين');
                }

                // التحقق من صحة البريد الإلكتروني
                if (!userManager.isValidEmail(email)) {
                    throw new Error('بريد إلكتروني غير صالح');
                }

                // التحقق من قوة كلمة المرور
                if (!userManager.isStrongPassword(password)) {
                    throw new Error('كلمة المرور ضعيفة جداً');
                }

                const user = userManager.register(name, email, password);
                updateAuthUI();
                closeAuthModal();
                showNotification(`تم إنشاء حسابك بنجاح! مرحباً ${user.name}`, 'success');
                
                return true;
            } catch (error) {
                showNotification(error.message, 'error');
                return false;
            }
        }

        // تسجيل الخروج
        function logout() {
            userManager.logout();
            updateAuthUI();
            showNotification('تم تسجيل الخروج بنجاح', 'info');
            navigateTo('home');
        }

        // حفظ بيانات الملف الشخصي
        function saveProfile() {
            if (!userManager.currentUser) {
                showNotification('يجب تسجيل الدخول أولاً', 'error');
                return;
            }

            const name = document.getElementById('nameInput').value;
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;

            const userData = { name, email };
            
            // إذا تم إدخال كلمة مرور جديدة
            if (password) {
                userData.password = userManager.hashPassword(password);
            }

            userManager.updateUser(userData);
            showNotification('تم حفظ البيانات بنجاح!', 'success');
        }

        // تبديل التذكيرات
        function toggleReminder(type) {
            if (!userManager.currentUser) {
                showNotification('يجب تسجيل الدخول أولاً', 'error');
                return;
            }

            const toggle = document.getElementById(type + 'Reminder');
            toggle.classList.toggle('active');
            
            userManager.currentUser.preferences[type + 'Reminder'] = toggle.classList.contains('active');
            userManager.updateUser(userManager.currentUser);
            
            showNotification(
                `تم ${toggle.classList.contains('active') ? 'تفعيل' : 'تعطيل'} التذكير ${type === 'daily' ? 'اليومي' : 'الأسبوعي'}`,
                'info'
            );
        }

        // إظهار الإشعارات
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const icon = notification.querySelector('i');
            
            // تحديث الأيقونة والنوع
            notification.className = `notification ${type}`;
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else if (type === 'info') {
                icon.className = 'fas fa-info-circle';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-triangle';
            }
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // التحقق من صحة النموذج
        function validateForm(formId) {
            const form = document.getElementById(formId);
            const inputs = form.querySelectorAll('input[required]');
            let isValid = true;

            inputs.forEach(input => {
                const errorElement = document.getElementById(input.id + 'Error');
                
                if (!input.value.trim()) {
                    errorElement.classList.add('show');
                    isValid = false;
                } else {
                    errorElement.classList.remove('show');
                }

                // التحقق الخاص بحقل كلمة المرور في التسجيل
                if (formId === 'registerForm' && input.id === 'registerPassword') {
                    if (input.value.length < 6) {
                        errorElement.textContent = 'كلمة المرور يجب أن تكون 6 أحرف على الأقل';
                        errorElement.classList.add('show');
                        isValid = false;
                    }
                }

                // التحقق من تطابق كلمتي المرور
                if (formId === 'registerForm' && input.id === 'registerConfirmPassword') {
                    const password = document.getElementById('registerPassword').value;
                    if (input.value !== password) {
                        errorElement.classList.add('show');
                        isValid = false;
                    }
                }
            });

            return isValid;
        }

        // تبديل اللغة
        function selectLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadText();
        }

        // اختيار طول النص
        function selectTextLength(length) {
            currentTextLength = length;
            document.querySelectorAll('.text-length-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadText();
        }

        // تحميل نص عشوائي
        function loadText() {
            const textDisplay = document.getElementById('textDisplay');
            textDisplay.innerHTML = '<div class="text-loader"><i class="fas fa-spinner"></i><p>جاري تحميل النص...</p></div>';
            
            // محاكاة تحميل النص
            setTimeout(() => {
                const text = userManager.getRandomText(currentLanguage, currentDifficulty, currentTextLength);
                textDisplay.textContent = text;
                textDisplay.classList.add('active');
                
                // توليد معرف فريد للنص
                currentTextId = `${currentLanguage}_${currentDifficulty}_${currentTextLength}_${Date.now()}`;
                
                // تحميل التقدم المحفوظ
                loadTrainingProgress();
            }, 500);
        }

        // تحميل تقدم التدريب المحفوظ
        function loadTrainingProgress() {
            if (!userManager.currentUser) return;
            
            const progress = userManager.loadTrainingProgress(currentTextId);
            if (progress) {
                document.getElementById('typingArea').value = progress.typedText;
                document.getElementById('progressFill').style.width = `${progress.progress}%`;
                
                showNotification('تم استعادة تقدمك السابق', 'info');
            }
        }

        // بدء التدريب
        function startTraining() {
            if (!userManager.currentUser) {
                showNotification('يجب تسجيل الدخول لبدء التدريب', 'error');
                showAuthModal();
                return;
            }

            trainingActive = true;
            startTime = new Date();
            const typingArea = document.getElementById('typingArea');
            typingArea.value = '';
            typingArea.focus();
            document.getElementById('progressFill').style.width = '0%';
            
            // تشغيل المؤقت
            const timerInterval = setInterval(() => {
                if (!trainingActive) {
                    clearInterval(timerInterval);
                    return;
                }
                updateTimer();
            }, 1000);

            // مراقبة الكتابة
            typingArea.addEventListener('input', updateStats);
            
            showNotification('بدأ التدريب! حظاً موفقاً', 'info');
        }

        // تحديث الإحصائيات
        function updateStats() {
            if (!trainingActive) return;

            const typedText = document.getElementById('typingArea').value;
            const originalText = document.getElementById('textDisplay').textContent;
            
            // حساب التقدم
            const progress = (typedText.length / originalText.length) * 100;
            document.getElementById('progressFill').style.width = `${Math.min(progress, 100)}%`;
            
            // حفظ التقدم
            if (userManager.currentUser && currentTextId) {
                userManager.saveTrainingProgress(currentTextId, progress, typedText);
            }
            
            // حساب الكلمات في الدقيقة
            const timeElapsed = (new Date() - startTime) / 1000 / 60;
            const wordsTyped = typedText.split(/\s+/).filter(word => word.length > 0).length;
            const wpm = Math.round(wordsTyped / timeElapsed);
            
            // حساب الدقة
            let errors = 0;
            for (let i = 0; i < typedText.length; i++) {
                if (typedText[i] !== originalText[i]) {
                    errors++;
                    if (soundEnabled) playErrorSound();
                }
            }
            const accuracy = typedText.length > 0 
                ? Math.round(((typedText.length - errors) / typedText.length) * 100) 
                : 100;

            // تحديث الواجهة
            document.getElementById('wpm').textContent = wpm;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            document.getElementById('errors').textContent = errors;
            
            // تحديث النجوم بناءً على الأداء
            updateStars(wpm, accuracy);
            
            // إكمال التدريب
            if (typedText.length >= originalText.length) {
                completeTraining(wpm, accuracy, errors);
            }
        }

        // تحديث النجوم
        function updateStars(wpm, accuracy) {
            const stars = document.querySelectorAll('#trainingRating .star');
            let starCount = 0;
            
            if (wpm >= 80 && accuracy >= 95) starCount = 5;
            else if (wpm >= 60 && accuracy >= 90) starCount = 4;
            else if (wpm >= 40 && accuracy >= 85) starCount = 3;
            else if (wpm >= 30 && accuracy >= 80) starCount = 2;
            else if (wpm >= 20 && accuracy >= 75) starCount = 1;
            
            stars.forEach((star, index) => {
                if (index < starCount) {
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                }
            });
        }

        // إكمال التدريب
        function completeTraining(wpm, accuracy, errors) {
            trainingActive = false;
            
            // تحديث إحصائيات المستخدم
            userManager.updateStats(wpm, accuracy, errors);
            
            // منح الإنجازات
            if (errors === 0) {
                userManager.addAchievement('perfectionist');
            }
            if (wpm >= 100) {
                userManager.addAchievement('speed_demon');
            }
            if (userManager.currentUser.stats.streak >= 7) {
                userManager.addAchievement('consistent');
            }
            
            // إظهار النتائج
            let message = `أحسنت! سرعتك: ${wpm} كلمة/دقيقة، دقتك: ${accuracy}%`;
            if (errors === 0) message += ' - بدون أخطاء!';
            
            showNotification(message, 'success');
            
            // تحديث واجهة المستخدم
            updateAuthUI();
        }

        // تحديث المؤقت
        function updateTimer() {
            const elapsed = Math.floor((new Date() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('timer').textContent = `${minutes}:${seconds}`;
        }

        // إعادة تعيين التدريب
        function resetTraining() {
            trainingActive = false;
            document.getElementById('typingArea').value = '';
            document.getElementById('wpm').textContent = '0';
            document.getElementById('accuracy').textContent = '100%';
            document.getElementById('errors').textContent = '0';
            document.getElementById('timer').textContent = '00:00';
            document.getElementById('progressFill').style.width = '0%';
            
            // إعادة النجوم
            document.querySelectorAll('#trainingRating .star').forEach(star => {
                star.classList.remove('filled');
            });
            
            showNotification('تم إعادة التدريب', 'info');
        }

        // بدء تحدي السرعة
        function startSpeedChallenge() {
            if (!userManager.currentUser) {
                showNotification('يجب تسجيل الدخول لبدء التحدي', 'error');
                showAuthModal();
                return;
            }
            
            navigateTo('training');
            setTimeout(() => {
                // تحديد نص قصير للتحدي
                const text = userManager.getRandomText(currentLanguage, 'beginner', 'short');
                document.getElementById('textDisplay').textContent = text;
                document.getElementById('textDisplay').classList.add('active');
                
                // بدء التحدي
                startTraining();
                
                showNotification('بدأ تحدي السرعة! لديك دقيقة واحدة', 'warning');
                
                // إنهاء التحدي بعد دقيقة
                setTimeout(() => {
                    if (trainingActive) {
                        completeTraining(
                            parseInt(document.getElementById('wpm').textContent),
                            parseInt(document.getElementById('accuracy').textContent),
                            parseInt(document.getElementById('errors').textContent)
                        );
                    }
                }, 60000);
            }, 100);
        }

        // تشغيل صوت الخطأ
        function playErrorSound() {
            const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');
            audio.play();
        }

        // تبديل الصوت
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const icon = document.getElementById('soundIcon');
            icon.className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
            
            // حفظ التفضيل
            if (userManager.currentUser) {
                userManager.currentUser.preferences.soundEnabled = soundEnabled;
                userManager.updateUser(userManager.currentUser);
            }
            
            showNotification(
                soundEnabled ? 'تم تفعيل الصوت' : 'تم كتم الصوت',
                'info'
            );
        }

        // حفظ النص كمفضل
        function saveToFavorites() {
            if (!userManager.currentUser) {
                showNotification('يجب تسجيل الدخول لحفظ النصوص', 'error');
                return;
            }

            const text = document.getElementById('textDisplay').textContent;
            
            if (!userManager.currentUser.favorites.includes(text)) {
                userManager.currentUser.favorites.push(text);
                userManager.updateUser({ favorites: userManager.currentUser.favorites });
                updateUserFavorites();
                showNotification('تم الحفظ في المفضلة!', 'success');
            } else {
                showNotification('النص موجود بالفعل في المفضلة', 'info');
            }
        }

        // تحميل التحديات
        function loadChallenges(type) {
            currentChallengeType = type;
            const challengesList = document.getElementById('challengesList');
            challengesList.innerHTML = '';
            
            const challenges = challengesDB[type];
            
            challenges.forEach(challenge => {
                const challengeCard = document.createElement('div');
                challengeCard.className = 'challenge-card';
                challengeCard.innerHTML = `
                    <div class="challenge-header">
                        <h3 class="challenge-title">${challenge.title}</h3>
                        <span class="challenge-badge">${challenge.points} نقطة</span>
                    </div>
                    <p class="challenge-description">${challenge.description}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${getChallengeProgress(challenge.id)}%"></div>
                    </div>
                    <div class="challenge-rewards">
                        <div class="challenge-points">
                            <i class="fas fa-coins"></i>
                            ${challenge.points} نقطة
                        </div>
                        <button class="btn btn-primary" onclick="startChallenge(${challenge.id})">
                            <i class="fas fa-play"></i>
                            ابدأ التحدي
                        </button>
                    </div>
                `;
                challengesList.appendChild(challengeCard);
            });
            
            // تحديث أزرار التبويب
            document.querySelectorAll('.challenge-tabs .btn').forEach(btn => {
                btn.className = 'btn btn-outline';
            });
            event.target.className = 'btn btn-primary';
        }

        // حساب تقدم التحدي
        function getChallengeProgress(challengeId) {
            if (!userManager.currentUser) return 0;
            
            const userChallenges = userManager.currentUser.challenges[currentChallengeType];
            const challenge = userChallenges.find(c => c.id === challengeId);
            
            return challenge ? challenge.progress : 0;
        }

        // بدء التحدي
        function startChallenge(challengeId) {
            if (!userManager.currentUser) {
                showNotification('يجب تسجيل الدخول لبدء التحدي', 'error');
                showAuthModal();
                return;
            }
            
            // البحث عن التحدي
            let challenge = null;
            for (const type in challengesDB) {
                challenge = challengesDB[type].find(c => c.id === challengeId);
                if (challenge) break;
            }
            
            if (!challenge) return;
            
            // الانتقال لصفحة التدريب مع إعدادات التحدي
            navigateTo('training');
            
            setTimeout(() => {
                showNotification(`بدأ تحدي: ${challenge.title}`, 'info');
                
                // إعداد التحدي
                if (challenge.targetWords) {
                    // تحدي عدد الكلمات
                    const text = userManager.getRandomText(currentLanguage, 'intermediate', 'medium');
                    document.getElementById('textDisplay').textContent = text;
                    startTraining();
                    
                    if (challenge.timeLimit) {
                        setTimeout(() => {
                            if (trainingActive) {
                                completeTraining(
                                    parseInt(document.getElementById('wpm').textContent),
                                    parseInt(document.getElementById('accuracy').textContent),
                                    parseInt(document.getElementById('errors').textContent)
                                );
                            }
                        }, challenge.timeLimit * 1000);
                    }
                }
            }, 100);
        }

        // تحديث لوحة المتصدرين
        function updateLeaderboard() {
            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = '';
            
            // ترتيب المستخدمين حسب النقاط
            const sortedUsers = [...userManager.users].sort((a, b) => b.stats.points - a.stats.points);
            
            // عرض أفضل 10 مستخدمين
            sortedUsers.slice(0, 10).forEach((user, index) => {
                const row = document.createElement('tr');
                const avgWpm = user.stats.wpm.length > 0 
                    ? Math.round(user.stats.wpm.reduce((a, b) => a + b, 0) / user.stats.wpm.length)
                    : 0;
                const avgAccuracy = user.stats.accuracy.length > 0
                    ? Math.round(user.stats.accuracy.reduce((a, b) => a + b, 0) / user.stats.accuracy.length)
                    : 0;
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.name}</td>
                    <td>${avgWpm} كلمة/دقيقة</td>
                    <td>${avgAccuracy}%</td>
                    <td>${user.stats.points}</td>
                `;
                leaderboardBody.appendChild(row);
            });
        }

        // إنشاء رسم بياني
        function createProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            // استخدام بيانات المستخدم الحالية
            const userStats = userManager.currentUser ? userManager.currentUser.stats : null;
            const wpmData = userStats && userStats.wpm.length > 0 
                ? userStats.wpm.slice(-7) 
                : [30, 35, 42, 48, 55, 62, 68];
            const accuracyData = userStats && userStats.accuracy.length > 0
                ? userStats.accuracy.slice(-7)
                : [85, 88, 92, 95, 96, 97, 98];
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['يوم 1', 'يوم 2', 'يوم 3', 'يوم 4', 'يوم 5', 'يوم 6', 'يوم 7'],
                    datasets: [{
                        label: 'السرعة (كلمة/دقيقة)',
                        data: wpmData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'الدقة (%)',
                        data: accuracyData,
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'تقدمك خلال الأسبوع الماضي'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // تصدير الإحصائيات كـ PDF
        function exportStats() {
            if (!userManager.currentUser) {
                showNotification('يجب تسجيل الدخول لتصدير الإحصائيات', 'error');
                return;
            }

            showNotification('جاري إنشاء تقرير PDF...', 'info');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // إعداد الخط العربي
            doc.addFont('https://fonts.gstatic.com/s/cairo/v17/SLXGc1nY6HkvangtZmpQdkhzfH5jkS0.woff2', 'Cairo', 'normal');
            doc.setFont('Cairo');
            
            const user = userManager.currentUser;
            
            // العنوان
            doc.setFontSize(20);
            doc.text('تقرير تقدم المستخدم - نبض الحروف', 105, 20, { align: 'center' });
            
            // المعلومات الأساسية
            doc.setFontSize(14);
            doc.text(`اسم المستخدم: ${user.name}`, 20, 40);
            doc.text(`المستوى: ${user.stats.level}`, 20, 50);
            doc.text(`النقاط: ${user.stats.points}`, 20, 60);
            doc.text(`تاريخ التقرير: ${new Date().toLocaleDateString('ar')}`, 20, 70);
            
            // الإحصائيات
            doc.setFontSize(16);
            doc.text('الإحصائيات العامة:', 20, 90);
            doc.setFontSize(12);
            doc.text(`أفضل سرعة: ${user.stats.bestSpeed} كلمة/دقيقة`, 20, 100);
            doc.text(`إجمالي الجلسات: ${user.stats.sessionsCompleted}`, 20, 110);
            doc.text(`معدل التحسن الشهري: ${userManager.calculateMonthlyImprovement()}%`, 20, 120);
            doc.text(`الأيام المتتالية: ${user.stats.streak}`, 20, 130);
            
            // حفظ الملف
            doc.save(`تقرير_${user.name}_${new Date().toISOString().split('T')[0]}.pdf`);
            
            showNotification('تم تحميل التقرير بنجاح!', 'success');
        }

        // مشاركة التقدم
        function shareProgress() {
            if (!userManager.currentUser) {
                showNotification('يجب تسجيل الدخول لمشاركة تقدمك', 'error');
                return;
            }
            
            showShareModal();
        }

        // عرض نافذة المشاركة
        function showShareModal() {
            document.getElementById('shareModal').classList.add('show');
        }

        // إغلاق نافذة المشاركة
        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
        }

        // المشاركة على فيسبوك
        function shareOnFacebook() {
            const user = userManager.currentUser;
            const text = `لقد حققت ${user.stats.points} نقطة في نبض الحروف! سرعتي القصوى ${user.stats.bestSpeed} كلمة/دقيقة. حاول أن تتغلب علي!`;
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        // المشاركة على تويتر
        function shareOnTwitter() {
            const user = userManager.currentUser;
            const text = `لقد حققت ${user.stats.points} نقطة في نبض الحروف! سرعتي القصوى ${user.stats.bestSpeed} كلمة/دقيقة. حاول أن تتغلب علي! #نبض_الحروف`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank');
        }

        // المشاركة على واتساب
        function shareOnWhatsApp() {
            const user = userManager.currentUser;
            const text = `لقد حققت ${user.stats.points} نقطة في نبض الحروف! سرعتي القصوى ${user.stats.bestSpeed} كلمة/دقيقة. حاول أن تتغلب علي! ${window.location.href}`;
            const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        // تبديل الوضع الليلي
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            // حفظ تفضيل المستخدم
            if (userManager.currentUser) {
                userManager.currentUser.preferences.theme = isDark ? 'dark' : 'light';
                userManager.updateUser(userManager.currentUser);
            }
            
            showNotification(
                isDark ? 'تم تفعيل الوضع الليلي' : 'تم تفعيل الوضع النهاري',
                'info'
            );
        }

        // التنقل بين الصفحات
        function navigateTo(page) {
            document.querySelectorAll('section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(page).style.display = 'block';
            
            // تحديث الروابط النشطة
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${page}`) {
                    link.classList.add('active');
                }
            });
            
            // تحديث محتوى الصفحة
            switch(page) {
                case 'challenges':
                    loadChallenges('daily');
                    updateLeaderboard();
                    break;
                case 'stats':
                    setTimeout(createProgressChart, 100);
                    break;
                case 'profile':
                    updateUserProfileUI();
                    break;
                case 'privacy':
                    updatePrivacyDate();
                    break;
            }
            
            // التمرير لأعلى الصفحة
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // تحديث تاريخ سياسة الخصوصية
        function updatePrivacyDate() {
            const date = new Date().toLocaleDateString('ar', { year: 'numeric', month: 'long' });
            document.getElementById('privacyUpdateDate').textContent = date;
        }

        // عرض دليل المستخدم
        function showUserGuide() {
            showNotification('جاري فتح دليل المستخدم...', 'info');
            // هنا يمكن إضافة نافذة منبثقة أو الانتقال لصفحة الدليل
        }

        // عرض الأسئلة الشائعة
        function showFAQ() {
            showNotification('جاري فتح الأسئلة الشائعة...', 'info');
            // هنا يمكن إضافة نافذة منبثقة أو الانتقال لصفحة الأسئلة
        }

        // عرض نموذج الاتصال
        function showContactForm() {
            showNotification('جاري فتح نموذج الاتصال...', 'info');
            // هنا يمكن إضافة نافذة منبثقة أو الانتقال لصفحة الاتصال
        }

        // عرض نموذج الإبلاغ عن خطأ
        function showBugReport() {
            showNotification('جاري فتح نموذج الإبلاغ عن خطأ...', 'info');
            // هنا يمكن إضافة نافذة منبثقة أو الانتقال لصفحة الإبلاغ
        }

        // عرض نموذج الاقتراحات
        function showSuggestionForm() {
            showNotification('جاري فتح نموذج الاقتراحات...', 'info');
            // هنا يمكن إضافة نافذة منبثقة أو الانتقال لصفحة الاقتراحات
        }

        // عرض الدروس التعليمية
        function showVideoTutorials() {
            showNotification('جاري فتح الدروس التعليمية...', 'info');
            // هنا يمكن إضافة نافذة منبثقة أو الانتقال لصفحة الدروس
        }

        // تحميل بيانات الملف الشخصي
        function loadProfile() {
            const darkMode = localStorage.getItem('darkMode') === 'true';
            
            if (darkMode) {
                document.body.classList.add('dark-mode');
            }
        }

        // إضافة تأثيرات التمرير
        function addScrollEffects() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.fade-in, .slide-in-left, .slide-in-right').forEach(el => {
                observer.observe(el);
            });
        }

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            loadProfile();
            updateAuthUI();
            loadText();
            addScrollEffects();
            
            // إضافة مستمعي الأحداث
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('href').substring(1);
                    navigateTo(page);
                });
            });

            // معالجة نموذج تسجيل الدخول
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!validateForm('loginForm')) {
                    return;
                }
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                login(email, password);
            });

            // معالجة نموذج التسجيل
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!validateForm('registerForm')) {
                    return;
                }
                
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                
                register(name, email, password, confirmPassword);
            });
            
            // إضافة تأثيرات GSAP
            gsap.from(".logo", {duration: 1, y: -50, opacity: 0, ease: "bounce.out"});
            gsap.from(".nav-links li", {duration: 0.8, y: -30, opacity: 0, stagger: 0.1});
            gsap.from(".hero-content", {duration: 1, y: 50, opacity: 0, delay: 0.3});
            gsap.from(".achievement-card", {duration: 0.8, y: 30, opacity: 0, stagger: 0.2, delay: 0.5});
            
            // تحديث تاريخ سياسة الخصوصية
            updatePrivacyDate();
        });

        // إضافة تأثيرات عند التمرير
        window.addEventListener('scroll', function() {
            const scrolled = window.pageYOffset;
            const hero = document.querySelector('.hero');
            if (hero) {
                hero.style.transform = `translateY(${scrolled * 0.3}px)`;
            }
        });

        // إغلاق النوافذ عند الضغط خارجها
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // حفظ التقدم تلقائي قبل إغلاق الصفحة
        window.addEventListener('beforeunload', function() {
            if (trainingActive && userManager.currentUser && currentTextId) {
                const typedText = document.getElementById('typingArea').value;
                const progress = (typedText.length / document.getElementById('textDisplay').textContent.length) * 100;
                userManager.saveTrainingProgress(currentTextId, progress, typedText);
            }
        });
    </script>
</body>
</html>